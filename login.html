<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BAMS - Admin Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/apiConfig.js"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Inter", sans-serif;
      }

      body {
        background: linear-gradient(135deg, #004d40 0%, #00796b 50%, #004d40 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        position: relative;
      }

      /* Animated Background Elements */
      .bg-bubbles {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
      }

      .bubble {
        position: absolute;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        animation: float 15s infinite ease-in-out;
      }

      .bubble:nth-child(1) {
        width: 80px;
        height: 80px;
        left: 10%;
        animation-delay: 0s;
        animation-duration: 20s;
      }

      .bubble:nth-child(2) {
        width: 120px;
        height: 120px;
        left: 20%;
        top: 20%;
        animation-delay: 2s;
        animation-duration: 25s;
      }

      .bubble:nth-child(3) {
        width: 60px;
        height: 60px;
        left: 30%;
        top: 60%;
        animation-delay: 4s;
        animation-duration: 18s;
      }

      .bubble:nth-child(4) {
        width: 100px;
        height: 100px;
        left: 70%;
        top: 10%;
        animation-delay: 1s;
        animation-duration: 22s;
      }

      .bubble:nth-child(5) {
        width: 90px;
        height: 90px;
        left: 80%;
        top: 70%;
        animation-delay: 3s;
        animation-duration: 19s;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0) rotate(0deg);
        }
        33% {
          transform: translateY(-30px) rotate(120deg);
        }
        66% {
          transform: translateY(20px) rotate(240deg);
        }
      }

      /* Login Card */
      .login-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 24px;
        padding: 3rem;
        width: 100%;
        max-width: 420px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.1);
        position: relative;
        z-index: 2;
        transform: translateY(0);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }

      .login-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 35px 60px -12px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.15);
      }

      .logo {
        width: 120px;
        height: auto;
        margin: 0 auto 1.5rem;
        display: block;
        filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
      }

      .brand-text {
        text-align: center;
        margin-bottom: 2.5rem;
      }

      .brand-text h1 {
        font-size: 2rem;
        font-weight: 700;
        color: #004d40;
        margin-bottom: 0.25rem;
      }

      .brand-text p {
        color: #00796b;
        font-size: 0.9rem;
        opacity: 0.8;
      }

      /* Input Groups */
      .input-group {
        position: relative;
        margin-bottom: 1.5rem;
      }

      .input-group input {
        width: 100%;
        padding: 1rem 1rem 1rem 3rem;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        font-size: 0.95rem;
        background: #ffffff;
        transition: all 0.3s ease;
        outline: none;
        color: #2d3748;
      }

      .input-group input:focus {
        border-color: #00796b;
        background: #f7fafc;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px -8px rgba(0, 121, 107, 0.3);
      }

      .input-group input::placeholder {
        color: #a0aec0;
        transition: all 0.3s ease;
      }

      .input-group input:focus::placeholder {
        transform: translateX(5px);
        opacity: 0.7;
      }

      .icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        width: 1.25rem;
        height: 1.25rem;
        color: #a0aec0;
        transition: all 0.3s ease;
        z-index: 3;
      }

      .input-group input:focus + .icon {
        color: #00796b;
        transform: translateY(-50%) scale(1.1);
      }

      /* Floating Label Animation */
      .input-group {
        position: relative;
      }

      .floating-label {
        position: absolute;
        left: 3rem;
        top: 50%;
        transform: translateY(-50%);
        color: #a0aec0;
        font-size: 0.95rem;
        pointer-events: none;
        transition: all 0.3s ease;
        background: #ffffff;
        padding: 0 0.25rem;
      }

      .input-group input:focus + .icon + .floating-label,
      .input-group input:not(:placeholder-shown) + .icon + .floating-label {
        top: 0;
        font-size: 0.8rem;
        color: #00796b;
        font-weight: 500;
      }

      /* Login Button */
      .login-button {
        width: 100%;
        padding: 1rem 2rem;
        background: linear-gradient(135deg, #00796b 0%, #004d40 100%);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .login-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 25px -8px rgba(0, 121, 107, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.1);
      }

      .login-button:active {
        transform: translateY(0);
      }

      .login-button::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s ease;
      }

      .login-button:hover::before {
        left: 100%;
      }

      /* Loading Animation */
      .loading-dots {
        display: inline-block;
        position: relative;
        width: 80px;
        height: 80px;
      }

      .loading-dots div {
        position: absolute;
        top: 33px;
        width: 13px;
        height: 13px;
        border-radius: 50%;
        background: #fff;
        animation-timing-function: cubic-bezier(0, 1, 1, 0);
      }

      .loading-dots div:nth-child(1) {
        left: 8px;
        animation: loading-dots1 0.6s infinite;
      }

      .loading-dots div:nth-child(2) {
        left: 8px;
        animation: loading-dots2 0.6s infinite;
      }

      .loading-dots div:nth-child(3) {
        left: 32px;
        animation: loading-dots2 0.6s infinite;
      }

      .loading-dots div:nth-child(4) {
        left: 56px;
        animation: loading-dots3 0.6s infinite;
      }

      @keyframes loading-dots1 {
        0% {
          transform: scale(0);
        }
        100% {
          transform: scale(1);
        }
      }

      @keyframes loading-dots3 {
        0% {
          transform: scale(1);
        }
        100% {
          transform: scale(0);
        }
      }

      @keyframes loading-dots2 {
        0% {
          transform: translate(0, 0);
        }
        100% {
          transform: translate(24px, 0);
        }
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        backdrop-filter: blur(5px);
      }

      .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 2rem;
        border-radius: 20px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        max-width: 400px;
        width: 90%;
        text-align: center;
        animation: modalAppear 0.3s ease-out;
      }

      @keyframes modalAppear {
        from {
          opacity: 0;
          transform: translate(-50%, -60%);
        }
        to {
          opacity: 1;
          transform: translate(-50%, -50%);
        }
      }

      .modal-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
      }

      .modal-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #004d40;
        margin-bottom: 1rem;
      }

      .modal-message {
        color: #666;
        margin-bottom: 2rem;
        line-height: 1.5;
      }

      .modal-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
      }

      .modal-button {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .modal-button.primary {
        background: linear-gradient(135deg, #00796b 0%, #004d40 100%);
        color: white;
      }

      .modal-button.secondary {
        background: #f1f5f9;
        color: #475569;
      }

      .modal-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px -8px rgba(0, 0, 0, 0.3);
      }

      /* Admin Badge */
      .admin-badge {
        display: inline-flex;
        align-items: center;
        background: linear-gradient(135deg, #00796b 0%, #004d40 100%);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        margin-bottom: 1rem;
      }

      .admin-badge svg {
        width: 16px;
        height: 16px;
        margin-right: 0.5rem;
      }

      /* Error message */
      .error-message {
        color: #e53e3e;
        font-size: 0.875rem;
        margin-top: 0.5rem;
        text-align: center;
        display: none;
      }

      /* Success message */
      .success-message {
        color: #38a169;
        font-size: 0.875rem;
        margin-top: 0.5rem;
        text-align: center;
        display: none;
      }
    </style>
  </head>
  <body>
    <!-- Animated Background Bubbles -->
    <div class="bg-bubbles">
      <div class="bubble"></div>
      <div class="bubble"></div>
      <div class="bubble"></div>
      <div class="bubble"></div>
      <div class="bubble"></div>
    </div>

    <div class="login-card">
      <img src="logo-bams.png" alt="BAMS Logo" class="logo" />
      <div class="brand-text">
        <h1>BAMS</h1>
        <p>Bali Air Monitoring System</p>
      </div>

      <!-- Admin Only Badge -->
      <div class="admin-badge">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
        </svg>
        ADMIN ACCESS ONLY
      </div>

      <form id="loginForm">
        <div class="input-group">
          <input type="text" id="username" placeholder=" " required />
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          <span class="floating-label">ADMIN USERNAME</span>
        </div>

        <div class="input-group">
          <input type="password" id="password" placeholder=" " required />
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
          </svg>
          <span class="floating-label">ADMIN PASSWORD</span>
        </div>

        <!-- Error message -->
        <div id="errorMessage" class="error-message"></div>

        <!-- Success message -->
        <div id="successMessage" class="success-message"></div>

        <button type="submit" class="login-button" id="loginBtn">
          <span id="btnText">ADMIN LOGIN</span>
          <div class="loading-dots" id="loadingDots" style="display: none">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
          </div>
        </button>
      </form>

      <div style="text-align: center; margin-top: 1.5rem">
        <p style="color: #666; font-size: 0.9rem">
          For public access, please visit our
          <a href="index.html" style="color: #00796b; text-decoration: none; font-weight: 500">public dashboard</a>
        </p>
      </div>
    </div>

    <!-- Access Denied Modal -->
    <div id="accessDeniedModal" class="modal">
      <div class="modal-content">
        <div class="modal-icon">üö´</div>
        <h2 class="modal-title">Access Restricted</h2>
        <p class="modal-message">This login portal is exclusively for authorized administrators only. Regular users can access the public dashboard to view air quality data.</p>
        <div class="modal-buttons">
          <button class="modal-button secondary" onclick="closeModal()">Stay Here</button>
          <button class="modal-button primary" onclick="goToDashboard()">View Public Dashboard</button>
        </div>
      </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal">
      <div class="modal-content">
        <div class="modal-icon">‚úÖ</div>
        <h2 class="modal-title">Welcome Admin!</h2>
        <p class="modal-message">Authentication successful. Redirecting to admin dashboard...</p>
        <div class="loading-dots" style="margin: 0 auto">
          <div></div>
          <div></div>
          <div></div>
          <div></div>
        </div>
      </div>
    </div>

    <!-- API Error Modal -->
    <div id="apiErrorModal" class="modal">
      <div class="modal-content">
        <div class="modal-icon">‚ö†Ô∏è</div>
        <h2 class="modal-title">Connection Error</h2>
        <p class="modal-message" id="apiErrorMessage">There was a problem connecting to the authentication service. Please try again later.</p>
        <div class="modal-buttons">
          <button class="modal-button primary" onclick="closeModal()">Try Again</button>
        </div>
      </div>
    </div>

    <script>
      // API endpoint
      const API_ENDPOINT = "https://9l5vu3c1zl.execute-api.ap-southeast-1.amazonaws.com/login";

      document.addEventListener("DOMContentLoaded", function () {
        const loginForm = document.getElementById("loginForm");
        const loginBtn = document.getElementById("loginBtn");
        const btnText = document.getElementById("btnText");
        const loadingDots = document.getElementById("loadingDots");
        const usernameInput = document.getElementById("username");
        const passwordInput = document.getElementById("password");
        const errorMessage = document.getElementById("errorMessage");
        const successMessage = document.getElementById("successMessage");

        // Function to show modal
        function showModal(modalId) {
          document.getElementById(modalId).style.display = "block";
          document.body.style.overflow = "hidden";
        }

        // Function to close modal
        function closeModal() {
          const modals = document.querySelectorAll(".modal");
          modals.forEach((modal) => {
            modal.style.display = "none";
          });
          document.body.style.overflow = "auto";
        }

        // Function to redirect to dashboard
        function goToDashboard() {
          closeModal();
          window.location.href = "index.html";
        }

        // Function to show error message
        function showError(message) {
          errorMessage.textContent = message;
          errorMessage.style.display = "block";
          successMessage.style.display = "none";
        }

        // Function to show success message
        function showSuccess(message) {
          successMessage.textContent = message;
          successMessage.style.display = "block";
          errorMessage.style.display = "none";
        }

        // Function to hide all messages
        function hideMessages() {
          errorMessage.style.display = "none";
          successMessage.style.display = "none";
        }

        // Function to validate form
        function validateForm(username, password) {
          hideMessages();

          if (!username || !password) {
            showError("Please fill in all fields");
            return false;
          }

          if (username.length < 3) {
            showError("Username must be at least 3 characters long");
            return false;
          }

          if (password.length < 6) {
            showError("Password must be at least 6 characters long");
            return false;
          }

          return true;
        }

        // Function to call API
        async function authenticateUser(username, password) {
          const requestData = {
            username: username,
            password: password,
          };

          try {
            const response = await fetch(API_ENDPOINT, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(requestData),
            });

            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            return data;
          } catch (error) {
            console.error("Authentication error:", error);
            throw error;
          }
        }

        // Form submission
        // Form submission
        loginForm.addEventListener("submit", async function (e) {
          e.preventDefault();

          const username = usernameInput.value.trim();
          const password = passwordInput.value.trim();

          // Validate form
          if (!validateForm(username, password)) {
            return;
          }

          // Show loading state
          btnText.style.display = "none";
          loadingDots.style.display = "inline-block";
          loginBtn.disabled = true;
          hideMessages();

          try {
            const result = await authenticateUser(username, password);

            // Reset button state
            btnText.style.display = "inline-block";
            loadingDots.style.display = "none";
            loginBtn.disabled = false;

            // Process result
            if (result.message === "Login berhasil" && result.token && result.username) {
              showSuccess("Login successful! Redirecting...");

              // Simpan token & data admin
              localStorage.setItem("adminToken", result.token);
              localStorage.setItem("adminData", JSON.stringify({ username: result.username || "Admin" }));

              showModal("successModal");

              setTimeout(() => {
                window.location.href = "index.html";
              }, 2000);
            } else {
              showError(result.message || "Invalid username or password");
              passwordInput.value = "";
            }
          } catch (error) {
            // Reset button state
            btnText.style.display = "inline-block";
            loadingDots.style.display = "none";
            loginBtn.disabled = false;

            // üî¥ DI SINI: pakai `error`, JANGAN `response`
            const msg = (error && error.message) || "There was an error connecting to the authentication service. Please try again later.";

            const apiErrorMessage = document.getElementById("apiErrorMessage");
            if (apiErrorMessage) {
              apiErrorMessage.textContent = msg;
            }

            showModal("apiErrorModal");
          }
        });

        // Close modal when clicking outside
        window.addEventListener("click", function (e) {
          if (e.target.classList.contains("modal")) {
            closeModal();
          }
        });

        // Interactive effects
        let mouseX = 0,
          mouseY = 0;
        document.addEventListener("mousemove", function (e) {
          mouseX = e.clientX;
          mouseY = e.clientY;
          const card = document.querySelector(".login-card");
          const centerX = window.innerWidth / 2;
          const centerY = window.innerHeight / 2;
          const xAxis = (centerX - mouseX) / 25;
          const yAxis = (centerY - mouseY) / 25;
          card.style.transform = `perspective(1000px) rotateY(${xAxis}deg) rotateX(${yAxis}deg) translateY(-5px)`;
        });

        document.addEventListener("mouseleave", function () {
          const card = document.querySelector(".login-card");
          card.style.transform = "perspective(1000px) rotateY(0deg) rotateX(0deg) translateY(0)";
        });

        // Auto-focus on username field
        usernameInput.focus();

        // Check if user is already logged in
        if (localStorage.getItem("adminToken")) {
          showSuccess("You are already logged in. Redirecting...");
          setTimeout(() => {
            window.location.href = "index.html";
          }, 1000);
        }
      });

      // Global functions untuk modal buttons
      window.closeModal = function () {
        const modals = document.querySelectorAll(".modal");
        modals.forEach((modal) => {
          modal.style.display = "none";
        });
        document.body.style.overflow = "auto";
      };

      window.goToDashboard = function () {
        closeModal();
        window.location.href = "index.html";
      };
    </script>
  </body>
</html>
